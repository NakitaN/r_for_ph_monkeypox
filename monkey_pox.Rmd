---
title: "Monkeypox"
output: pdf_document
author: "Susan Awor and Nakita Nicholls"
date: '2022-10-01'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Description of dataset
What is the data source? (1-2 sentences on where the data is coming from, dates included, etc.)

The monkeypox case data is from European Centre for Disease Prevention and Control.
The population denominator, world region, and census data are from Eurostat.

How does the dataset relate to the group problem statement and question?

Problem statement 1: Is there a difference between monkeypox cases by region in the EU?
We will be using the monkeypox data, population denominator and region data sets to help us find the difference between monkeypox cases by region in the EU.

Problem statement 2: Is there a difference between country level monkeypox case rates by certain demographic factors?
We will use the monkeypox case, population denominator and census data to see if there is a difference between country level case rates based on certain demographic factors.

\newpage

# Import statement

```{r}
library(readr)
library(dplyr)
library(tidyverse)
library(stringr)
library(lubridate)
```
Use appropriate import function and package based on the type of file
```{r}
mp_cases <-read_csv("~/r_for_ph_monkeypox/euro_mpx_cases.csv")
pop_den <- read_csv("~/r_for_ph_monkeypox/euro_pop_denominators.csv")
eu_census <- read_csv("euro_census_stats.csv")
wrld_region <- read_csv("~/r_for_ph_monkeypox/world_country_regions.csv")
```

Utilize function arguments to control relevant components (i.e. change column types, column names, missing values, etc.)
```{r,eucensus}
clean_eu_census <- rename_with(eu_census, ~ tolower((gsub(" ", "_",.x,fixed=TRUE)))) %>%
  select(c(-"flags",-"footnotes"))
```
```{r,mpx}
clean_mp_cases <- rename_with(mp_cases, ~ tolower((gsub(" ", "_",.x,fixed=TRUE)))) %>%
  select(c(-"source"))
```
```{r, popden}
clean_pop_den <- rename_with(pop_den, ~ tolower((gsub(" ", "_",.x,fixed=TRUE)))) %>%
  select(c(-"dataflow", -"last_update", -"freq", -"obs_flag"))
```
```{r}
clean_wrld_region <- filter(wrld_region, region == "Europe") %>%
  select(c(-"alpha-3", -"iso_3166-2", -"intermediate-region"))
```

Document the import process
1. We navigated to the PHW290/phw251_projectdata git repo. We clicked on Code and downloaded the Zip file which we then extracted the csv files from. We imported the relevant datasets into our RStudio files for this project.


\newpage
# Identify data types for 5+ data elements/columns/variables
Identify 5+ data elements required for your specified scenario. If <5 elements are required to complete the analysis, please choose additional variables of interest in the data set to explore in this milestone.

daterep = date
confcases = numeric
sub_region =character
age = character
edu = character
countrycode = character
county_code = character
geo = character


Identify the desired type/format for each variableâ€”will you need to convert any columns to numeric or another type? 
We would have desired for the age variable to be numeric. 

Utilize functions or resources in RStudio to determine the types of each data element (i.e. character, numeric, factor)
```{r}
str(clean_pop_den)
str(clean_eu_census)
str(clean_mp_cases)
str(clean_wrld_region)
```

\newpage
# Provide a basic description of the 5+ data elements
Numeric: mean, median, range
Character:  unique values/categories
Or any other descriptives that will be useful to the analysis

We will use the daterep column from the clean_mp_cases data set to establish the number of confirmed cases per or per month. daterep lists the date that the cases were confirmed on. 


We used the summary function to give us a summary of monkeypox cases in the entire dataset
```{r}
summary(clean_mp_cases$confcases)
```
We will the sub-region column to categorize the different EU countries by region.

We will use the eu census dataset to look at the age and education demographic(columns "age" and "edu") and their relationship to monkeypox cases.


We will use the countrycode/geo/country_code columns which are listed in all datasets to join our datasets as needed in the future milestone(s).

\newpage
Please turn in a PDF created from an Rmd with the following components -

Subset rows or columns, as needed
```{r}
unique(clean_mp_cases$countrycode)
unique(clean_pop_den$geo)

```
```{r}
pop_den_geo <- filter(clean_pop_den,geo %in% c("AT", "BE", "BG", "HR", "CY", "CZ", "DK", "EE", 
                                               "FI", "FR","DE", "EL", "HU","IS", "IE" ,"IT", "LV", 
                                               "LT","LU", "MT", "NL", "NO","PL", "PT", "RO", "SK", "SI", "ES", "SE"),time_period == 2022) %>%
                        select(-indic_de)
```

```{r}
date_mp_cases <- clean_mp_cases %>%
   group_by(countrycode, countryexp, month = floor_date(daterep, 'month')) %>%
    summarize(monthly_total_cases = sum(confcases))


```
```{r}
join_df <- left_join(pop_den_geo, date_mp_cases, by = c("geo" = "countrycode"))
```
```{r}
join_df$countryexp <- str_to_upper(join_df$countryexp)
```
```{r}
regions_df <-clean_wrld_region %>%
  select(name, `sub-region`)
```
```{r}
join_region_mp <- inner_join(regions_df, join_df, by = c("name" = "countryexp"))
```

testing123

Create new variables needed for analysis (minimum 2)
New variables should be created based on existing columns; for example
Calculating a rate
Combining character strings
If no new values are needed for final tables/graphs, please create 2 new variables anyway
Clean variables needed for analysis (minimum 2)
Examples
Recode invalid values
Handle missing fields
Recode categories
If not needed for final analysis, please create at least 2 new variables anyway
Data dictionary based on clean dataset (minimum 4 data elements), including:
Variable name
Data type
Description
One or more tables with descriptive statistics for 4 data element
PDF that is professionally prepared for presentation
Each part of the milestone is clearly on one page (use \newpage to push to a new page)
Only the necessary information is outputted (you should suppress, for example, entire data frame outputs)
Use of headers and sub headers to create an organized document